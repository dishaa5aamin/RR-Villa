<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Villa Resort</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --forest: #1b4332; --mint: #95d5b2; }
        .sidebar { background: var(--forest); color: white; min-height: 100vh; padding: 20px; }
        .btn-nav { color: white; border: 1px solid rgba(255,255,255,0.2); margin-bottom: 10px; width: 100%; text-align: left; }
        .btn-nav:hover { background: var(--mint); color: var(--forest); }
        .card-main { border-radius: 15px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-2 sidebar d-flex flex-column">
            <h4 class="fw-bold mb-4">Admin Dashboard</h4>
            <button class="btn btn-nav" onclick="loadData('bookings')">üìÖ Bookings</button>
            <button class="btn btn-nav" onclick="loadData('messages')">‚úâ Messages</button>
            <a href="index.html" class="btn btn-nav mt-auto">‚Üê Back to Site</a>
        </div>

        <div class="col-md-10 p-5">
            <h2 id="title" class="mb-4">Welcome, Admin</h2>
            <div class="card card-main p-4">
                <table class="table align-middle">
                    <thead id="tableHead" class="table-light"></thead>
                    <tbody id="tableBody">
                        <tr><td class="text-center p-5">Select a category to view data</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // FIXED: Updated to point to your Railway URL
    const API_BASE = "https://villa-resort-app-production.up.railway.app/api/admin";

    async function loadData(type) {
        document.getElementById('title').innerText = type.toUpperCase();
        const head = document.getElementById('tableHead');
        const body = document.getElementById('tableBody');
        
        head.innerHTML = type === 'bookings' ? 
            `<tr><th>Guest</th><th>Location</th><th>Check-In</th><th>Action</th></tr>` : 
            `<tr><th>Sender</th><th>Subject</th><th>Message</th><th>Action</th></tr>`;

        try {
            const res = await fetch(`${API_BASE}/${type}`);
            const data = await res.json();
            
            body.innerHTML = data.map(item => `
                <tr>
                    <td><b>${item.fullName || item.name}</b><br><small>${item.email}</small></td>
                    <td>${item.location || item.subject}</td>
                    <td>${item.checkIn || (item.message ? item.message.substring(0,20) + '...' : 'No message')}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('${type}', '${item._id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
            
            if(data.length === 0) body.innerHTML = '<tr><td colspan="4" class="text-center">No data found</td></tr>';
        } catch (e) { 
            console.error(e);
            alert("Error loading data. Make sure the server is live."); 
        }
    }

    async function deleteItem(type, id) {
        if(confirm("Delete this entry forever?")) {
            try {
                await fetch(`${API_BASE}/${type}/${id}`, { method: 'DELETE' });
                loadData(type);
            } catch (e) {
                alert("Could not delete item.");
            }
        }
    }
</script>
</body>
</html>